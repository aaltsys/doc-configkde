<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Mounting Devices through udev &mdash; Configure KDE 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/aaltsys.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Configure KDE 1.0 documentation" href="index.html" />
    <link rel="prev" title="DOS programs with dosemu" href="05_dosemu.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="05_dosemu.html" title="DOS programs with dosemu"
             accesskey="P">previous</a></li>
        <li><a href="index.html">Configure KDE 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Mounting Devices through udev</a><ul>
<li><a class="reference internal" href="#esata-hot-mount-drive-setup">eSATA hot-mount drive setup</a></li>
<li><a class="reference internal" href="#disconnecting-a-hot-mounted-drive">Disconnecting a hot-mounted drive</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="05_dosemu.html"
                        title="previous chapter">DOS programs with dosemu</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/09_udevmount.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="mounting-devices-through-udev">
<h1>Mounting Devices through udev<a class="headerlink" href="#mounting-devices-through-udev" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method of hot-mounting a drive is superceded.</p>
</div>
<div class="section" id="esata-hot-mount-drive-setup">
<h2>eSATA hot-mount drive setup<a class="headerlink" href="#esata-hot-mount-drive-setup" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This guide registers a <em>BUFFALO External</em> drive and mounts it at <em>/home/mnt/backup</em>.</p>
</div>
<ol class="arabic">
<li><p class="first">The permanent logical mount point for the backup device will be <tt class="docutils literal"><span class="pre">/home/mnt/backup</span></tt>.</p>
</li>
<li><p class="first">Display a terminal command line on the server console, or <em>ssh</em> to a server command shell.</p>
</li>
<li><p class="first">Plug in the hot-pluggable device on a <strong>USB</strong> or <strong>eSATA</strong> port.</p>
</li>
<li><p class="first">At the command prompt, type:</p>
<div class="highlight-python"><pre>dmesg | tail 20</pre>
</div>
</li>
<li><p class="first">Output similar to the following will be displayed:</p>
<div class="highlight-python"><pre>...
[ 5891.570018] ata6: link is slow to respond, please be patient (ready=0)
[ 5893.250023] ata6: SATA link up 3.0 Gbps (SStatus 123 SControl 300)
[ 5893.260131] ata6.00: ATA-6: BUFFALO External HDD, CC46, max UDMA/133
[ 5893.260136] ata6.00: 1953525168 sectors, multi 0: LBA48
[ 5893.271998] ata6.00: configured for UDMA/133
[ 5893.272007] ata6: EH complete
[ 5893.272117] scsi 5:0:0:0: Direct-Access     ATA      BUFFALO External CC46 PQ: 0 ANSI: 5
[ 5893.272339] sd 5:0:0:0: Attached scsi generic sg3 type 0
[ 5893.272669] sd 5:0:0:0: [sdc] 1953525168 512-byte logical blocks: (1.00 TB/931 GiB)
[ 5893.272727] sd 5:0:0:0: [sdc] Write Protect is off
[ 5893.272731] sd 5:0:0:0: [sdc] Mode Sense: 00 3a 00 00
[ 5893.272762] sd 5:0:0:0: [sdc] Write cache: enabled, read cache: enabled, doesn''t support DPO or FUA
[ 5893.272939]  sdc: sdc1 &lt; sdc5 &gt;
[ 5893.293515] sd 5:0:0:0: [sdc] Attached SCSI disk</pre>
</div>
</li>
<li><p class="first">This shows a <tt class="docutils literal"><span class="pre">BUFFALO</span> <span class="pre">External</span></tt> device as <tt class="docutils literal"><span class="pre">sdc</span></tt>. Enumerate the system device information for <tt class="docutils literal"><span class="pre">sdc</span></tt> with the command:</p>
<div class="highlight-python"><pre>udevadm info --name=sdc --attribute-walk</pre>
</div>
</li>
<li><p class="first">Now scroll up the output to find the <em>BUFFALO External</em> parent device section. Note the subsystem, model, and state:</p>
<div class="highlight-python"><pre>looking at parent device '/devices/pci0000:00/0000:00:1f.2/host5/target5:0:0/5:0:0:0':
   KERNELS=="5:0:0:0"
   SUBSYSTEMS=="scsi"
   DRIVERS=="**sd**"
   ATTRS{device_blocked}=="0"
   ATTRS{type}=="0"
   ATTRS{scsi_level}=="6"
   ATTRS{vendor}=="ATA     "
   ATTRS{model}=="BUFFALO External"
   ATTRS{rev}=="CC46"
   ATTRS{state}=="running"
   ...</pre>
</div>
</li>
<li><p class="first">Add a <tt class="docutils literal"><span class="pre">udev</span></tt> rule in directory <tt class="docutils literal"><span class="pre">/etc/udev/rules.d/</span></tt> to establish a mount for the device. We chose the filename:</p>
<div class="highlight-python"><pre>/etc/udev/rules.d/20-buffalo.rules</pre>
</div>
</li>
<li><p class="first">Edit the file and insert the rule. Our data for the command, based on the attributes above and the specified mount point, is:</p>
<div class="highlight-python"><pre>KERNEL=="sd?", SUBSYSTEMS=="scsi", ATTRS{model}=="BUFFALO External", ATTRS{state}=="running", RUN+="/bin/mount /dev/%k5 /home/mnt/backup"</pre>
</div>
</li>
<li><p class="first">After saving the rule, and with the device connected, verify the rule with the command:</p>
<div class="highlight-python"><pre>sudo reload udev
sudo udevadm test /block/sdc</pre>
</div>
</li>
<li><p class="first">The command output should be similar to the following:</p>
<div class="highlight-python"><pre>...
udevadm_test: ID_ATA_SATA=1
udevadm_test: ID_ATA_SATA_SIGNAL_RATE_GEN2=1
udevadm_test: ID_ATA_SATA_SIGNAL_RATE_GEN1=1
udevadm_test: ID_SCSI_COMPAT=SATA_BUFFALO_Externa_6VPB88MX
udevadm_test: ID_PATH=pci-0000:00:1f.2-scsi-2:0:0:0
udevadm_test: ID_PART_TABLE_TYPE=dos
udevadm_test: UDISKS_PRESENTATION_NOPOLICY=0
udevadm_test: UDISKS_PARTITION_TABLE=1
udevadm_test: UDISKS_PARTITION_TABLE_SCHEME=mbr
udevadm_test: UDISKS_PARTITION_TABLE_COUNT=2
udevadm_test: UDISKS_ATA_SMART_IS_AVAILABLE=1
udevadm_test: run: '/bin/mount /dev/sdc5 /home/mnt/backup'
udevadm_test: run: '/lib/udev/hdparm'
udevadm_test: run: 'socket:@/org/freedesktop/hal/udev_event'</pre>
</div>
</li>
<li><p class="first">Now unplug the <tt class="docutils literal"><span class="pre">eSATA</span></tt> or <tt class="docutils literal"><span class="pre">USB</span></tt> cable, and then plug it back into the device.</p>
</li>
<li><p class="first">Run the command <tt class="kbd docutils literal"><span class="pre">mount</span></tt> and look for the device in the command output, as for example the following:</p>
<div class="highlight-python"><pre>/dev/mapper/ddf1_aaltsys1 on / type ext4 (rw,errors=remount-ro)
...
none on /var/lib/ureadahead/debugfs type debugfs (rw,relatime)
/dev/mapper/ddf1_aaltsys6 on /home type ext4 (rw,usrquota,grpquota,acl)
rpc_pipefs on /var/lib/nfs/rpc_pipefs type rpc_pipefs (rw)
nfsd on /proc/fs/nfsd type nfsd (rw)
/dev/sdc5 on /home/mnt/backup type fuseblk (rw,nosuid,nodev,allow_other,blksize=4096)</pre>
</div>
</li>
</ol>
<p>The device is mounted and ready. Now it may be hot connected and disconnected, and it will auto-mount on connection.</p>
</div>
<div class="section" id="disconnecting-a-hot-mounted-drive">
<h2>Disconnecting a hot-mounted drive<a class="headerlink" href="#disconnecting-a-hot-mounted-drive" title="Permalink to this headline">¶</a></h2>
<p>Unmount a device before disconnecting it. In this example, the unmount command would be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">umount</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">backup</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Before disconnecting a hot-mounted device it must be unmounted. Otherwise the device may become corrupted or unusable.</p>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>We found the following guide useful: <cite>http://cdfx.penguins-on-hudson.com/2010/01/20/automount-removable-devices-on-ubuntu-servers/</cite>. Be aware that all the <strong>udev</strong> command syntax has changed since the guide was written, as the following table shows.</li>
</ol>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Command in Penguins Guide</th>
<th class="head">Current Command Syntax Equivalent</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>udevinfo -a -p /sys/block/sdb</td>
<td>udevadm info &#8211;name=sdb &#8211;attribute-walk</td>
</tr>
<tr class="row-odd"><td>sudo udevcontrol reload_rules</td>
<td>sudo reload udev</td>
</tr>
<tr class="row-even"><td>udevtest /sys/block/sdb/sdb1 usb</td>
<td>sudo udevadm test /block/sdb</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="05_dosemu.html" title="DOS programs with dosemu"
             >previous</a></li>
        <li><a href="index.html">Configure KDE 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Gerald Lovel.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b3.
    </div>
  </body>
</html>