<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Mounting Network File Systems &mdash; Configure KDE 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/aaltsys.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Configure KDE 1.0 documentation" href="index.html" />
    <link rel="next" title="Managing Software Packages" href="04_packages.html" />
    <link rel="prev" title="Remote Secure Shell Sessions" href="02_secureshell.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="04_packages.html" title="Managing Software Packages"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="02_secureshell.html" title="Remote Secure Shell Sessions"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Configure KDE 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Mounting Network File Systems</a><ul>
<li><a class="reference internal" href="#using-sshfs-file-shares-in-linux">Using sshfs File Shares in Linux</a><ul>
<li><a class="reference internal" href="#part-1-configure-filesystems">Part 1: Configure Filesystems</a></li>
<li><a class="reference internal" href="#part-2-setup-server-access">Part 2. Setup Server Access</a></li>
<li><a class="reference internal" href="#part-3-provide-your-ssh-key">Part 3. Provide your ssh key</a></li>
<li><a class="reference internal" href="#when-this-does-not-work">When this does not work</a></li>
</ul>
</li>
<li><a class="reference internal" href="#server-sshfs-configuration">Server SSHFS Configuration</a></li>
<li><a class="reference internal" href="#ssh-remote-consoles">SSH Remote Consoles</a><ul>
<li><a class="reference internal" href="#redirecting-ssh-to-putty">Redirecting SSH to PuTTY</a></li>
<li><a class="reference internal" href="#example-putty-session">Example PuTTY Session:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-samba4-shares">Using SAMBA4 Shares</a><ul>
<li><a class="reference internal" href="#configuring-ubuntu-desktop">Configuring Ubuntu desktop</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="02_secureshell.html"
                        title="previous chapter">Remote Secure Shell Sessions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="04_packages.html"
                        title="next chapter">Managing Software Packages</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/03_servershares.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="mounting-network-file-systems">
<h1>Mounting Network File Systems<a class="headerlink" href="#mounting-network-file-systems" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This guide describes connecting to either local or remote computer systems
from Debian/Ubuntu/Mint desktops. Syntax will differ with other systems.</p>
</div>
<div class="section" id="using-sshfs-file-shares-in-linux">
<h2>Using sshfs File Shares in Linux<a class="headerlink" href="#using-sshfs-file-shares-in-linux" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Throughout these instructions, replace <strong>HOSTNAME</strong>, <strong>DOMAIN</strong>, and
<strong>TLD</strong> with the host computer name to be accessed, the domain for the
host computer, and the top-level domain (.com, .net, etc.). For example,
<strong>HOSTNAME.DOMAIN.TLD</strong> might be replaced with <em>workserver.github.com</em>
for the work server at GitHub.</p>
</div>
<div class="section" id="part-1-configure-filesystems">
<h3>Part 1: Configure Filesystems<a class="headerlink" href="#part-1-configure-filesystems" title="Permalink to this headline">¶</a></h3>
<p>This section configures the desktop to use remote filesystems by installing and
loading the kernel module <strong>fuse</strong>, which is not included by default. Save the
bash script <a class="reference download internal" href="_downloads/fuse.sh"><tt class="xref download docutils literal"><span class="pre">fuse.sh</span></tt></a> to your home folder,
open a console session, and execute the script with the command:</p>
<div class="highlight-python"><pre>sudo bash fuse.sh</pre>
</div>
<p>Assign a local mount point (a file directory pointer) for shares on the remote
computer:</p>
<div class="highlight-python"><pre>sudo mkdir -p /mnt/HOSTNAME/</pre>
</div>
</div>
<div class="section" id="part-2-setup-server-access">
<h3>Part 2. Setup Server Access<a class="headerlink" href="#part-2-setup-server-access" title="Permalink to this headline">¶</a></h3>
<div class="sidebar">
<p class="first sidebar-title">/etc/auto.master</p>
<p>Each entry in <strong>auto.master</strong> defines a file access point which binds to a
remote computer. For example, file requests to <strong>/mnt/HOSTNAME</strong> will
automount <strong>HOSTNAME</strong> shares.       Shares will be unmounted if idle for over
30 seconds.</p>
<p><strong>/etc/auto.HOSTNAME</strong></p>
<p class="last">A list of share mappings is required for each remote computer. Here
<strong>HOSTNAME</strong> has two shares, <strong>PUBLIC</strong> and remote user home folder <strong>*</strong>.
Entries start with a name (e.g., <tt class="docutils literal"><span class="pre">public</span></tt>), followed by configuration
parameters, user ssh credentials, and the URI for accessing the share.</p>
</div>
<p>This section is performed once for each remote computer, to add information
about the computer to the local desktop. Instructions are provided using Domain
Names. IP addresses would also work, but then the shares would not be
accessible both locally and remotely. When DNS is properly configured, access
works whether the connection is local, bridged, VPN, or public.</p>
<p>Add a line describing a computer to <strong>auto.master</strong> with the following console
command (remember, replace HOSTNAME with the computer name):</p>
<div class="highlight-python"><pre>sudo bash &lt; &lt;(echo 'echo "/mnt/HOSTNAME /etc/auto.HOSTNAME --timeout=30 --ghost" &gt;&gt; /etc/auto.master')</pre>
</div>
<p>Create and edit the host computer configuration file, <tt class="file docutils literal"><span class="pre">auto.HOSTNAME</span></tt>, to
provide share-specific information:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sudoedit</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">auto</span><span class="o">.</span><span class="n">HOSTNAME</span>
</pre></div>
</div>
<p>and enter and save the share configuration information, such as:</p>
<div class="highlight-python"><pre>public -fstype=fuse,rw,nodev,nonempty,noatime,max_read=65536,allow_other,compression=yes,uid=$UID,gid=$GID,StrictHostKeyChecking=no,IdentityFile=$HOME/.ssh/id_rsa,umask=0007 :sshfs\#$USER@HOSTNAME.DOMAIN.TLD\:/home/samba/shares/public/
* -fstype=fuse,rw,allow_other,nodev,nonempty,noatime,max_read=65536,compression=yes,uid=$UID,gid=$GID,StrictHostKeyChecking=no,IdentityFile=$HOME/.ssh/id_rsa,umask=0077 :sshfs\#$USER@HOSTNAME.DOMAIN.TLD\:/home/&amp;</pre>
</div>
<p>Restart the autofs module to load the changed configuration:</p>
<div class="highlight-python"><pre>sudo service autofs restart
sudo ssh HOSTNAME.DOMAIN.TLD</pre>
</div>
<p>When prompted for the root password of the remote host, press <tt class="kbd docutils literal"><span class="pre">&lt;Ctrl-C&gt;</span></tt>
to exit the command.</p>
</div>
<div class="section" id="part-3-provide-your-ssh-key">
<h3>Part 3. Provide your ssh key<a class="headerlink" href="#part-3-provide-your-ssh-key" title="Permalink to this headline">¶</a></h3>
<p>This section must be performed for each local user who will access the remote
computer. Type the following commands to (1) create ssh keys provided a set
does not exist, and (2) copy the user public key to the remote computer for
authentication:</p>
<div class="highlight-python"><pre>if [ ! -f "$HOME/.ssh/id_rsa" ]; then ssh-keygen; fi
ssh-copy-id `id -un`@HOSTNAME.DOMAIN.TLD</pre>
</div>
<p>Now verify that the remote folders will mount:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ls</span> <span class="o">-</span><span class="n">al</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">HOSTNAME</span>
<span class="n">ls</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">HOSTNAME</span><span class="o">/</span><span class="sb">`id -un`</span>
</pre></div>
</div>
<p>Create desktop links to folders in <tt class="file docutils literal"><span class="pre">/mnt/HOSTNAME</span></tt> for easy access. On
workstations which might access servers remotely over slow Internet links, do
not create bookmarks.</p>
</div>
<div class="section" id="when-this-does-not-work">
<h3>When this does not work<a class="headerlink" href="#when-this-does-not-work" title="Permalink to this headline">¶</a></h3>
<p>If the public folder or user home folder will not mount, try the following:</p>
<div class="highlight-python"><pre>ssh `id -un`@HOSTNAME.DOMAIN.TLD
chmod og-w ~
chmod og-w ~/.ssh
chmod 600 ~/.ssh/authorized_keys</pre>
</div>
</div>
</div>
<div class="section" id="server-sshfs-configuration">
<h2>Server SSHFS Configuration<a class="headerlink" href="#server-sshfs-configuration" title="Permalink to this headline">¶</a></h2>
<p>Install authentication and sharing modules on the remote server as follows:</p>
<div class="highlight-python"><pre>sudo aptitude install openssh-server libpam-modules</pre>
</div>
<p>The default host umask=0022 will shade permissions for files and folders
created on the remote shares. Private home folders with umask=0077 will work
just fine, but public folders needing umask=0007 will result in incorrect
permissions which block write access. To prevent this problem:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sudoedit</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">pam</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">sshd</span>
</pre></div>
</div>
<p>Now add the following three lines:</p>
<div class="highlight-python"><pre># Default umask mask for SSH/SFTP sessions
# Shell sessions: Override with /etc/profile or ~/.bashrc or ~/.profile
session    optional     pam_umask.so umask=0000</pre>
</div>
<p>As noted above, actual ssh shell logins on the remote host will get the default
umask=022 on new files and directories. The following command will change this
for all shell logins:</p>
<div class="highlight-python"><pre>sudo sed -i s/umask 022/umask 0007/ /etc/profile</pre>
</div>
<p>A logged in user could change just her own default umask with the command:</p>
<div class="highlight-python"><pre>sudo sed -i s/#umask\ 022/umask\ 0007/ ~/.profile</pre>
</div>
<p>References:</p>
<p><a class="reference external" href="http://wiki.lapipaplena.org/index.php/How_to_mount_SFTP_accesses">How to mount SFTP accesses.</a></p>
</div>
<div class="section" id="ssh-remote-consoles">
<h2>SSH Remote Consoles<a class="headerlink" href="#ssh-remote-consoles" title="Permalink to this headline">¶</a></h2>
<p>A favorite Windows consultant expression is, &#8220;Just telnet into the server.&#8221;
<strong class="command">Telnet</strong> has been deprecated for a very long time in the Linux world.
Instead, <strong class="command">ssh</strong> provides encrypted communications for remote access
over insecure channels such as the Internet. We recommend using the
<strong class="command">PuTTY</strong> utility to manage <strong class="command">ssh</strong> sessions on all platforms.</p>
<div class="section" id="redirecting-ssh-to-putty">
<h3>Redirecting SSH to PuTTY<a class="headerlink" href="#redirecting-ssh-to-putty" title="Permalink to this headline">¶</a></h3>
<p>PuTTY is an open-source cross-platform client for secure ssh connections with
remote hosts. It is available on Windows, Linux, and Mac, and it is the
preferred client on Windows. PuTTY adds power to interactive sessions. For
example, a user can add a port forwarding rule within a running terminal session.</p>
<p>For a KDE desktop system derived from Debian, the following console commands
will redirect SSH to PuTTY (courtesy of VonGrippen, AKA Michael Cochran):</p>
<div class="highlight-python"><pre>bash &lt; &lt;(wget http://git.io/kde-putty -O-)</pre>
</div>
<p>Test the command&#8217;s result in your browser with the following link:</p>
<div class="highlight-python"><pre>ssh://github.com</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The URL <a class="reference external" href="http://git.io/kde-putty">http://git.io/kde-putty</a> points to the source file at
<a class="reference external" href="https://raw.github.com/aaltsys/doc-configkde/master/_downloads/putty-kde.sh">https://raw.github.com/aaltsys/doc-configkde/master/_downloads/putty-kde.sh</a>.
The URL shortening command was
<strong class="command">curl -i http://git.io -F &#8220;url=https://raw.github.com/aaltsys/doc-configkde/master/_downloads/putty-kde.sh&#8221; -F &#8220;code=kde-putty&#8221;</strong></p>
</div>
</div>
<div class="section" id="example-putty-session">
<h3>Example PuTTY Session:<a class="headerlink" href="#example-putty-session" title="Permalink to this headline">¶</a></h3>
<p>This program works magic which is best explained through an example, as follows.
An administrator wishes to connect to a remote Windows session running on a
network behind a Linux server. The Linux server is accessed at the domain
name <tt class="docutils literal"><span class="pre">https://HOSTNAME.DOMAIN.TLD</span></tt>. Both the Windows session and the Linux
server authenticate <tt class="docutils literal"><span class="pre">username</span></tt> and <tt class="docutils literal"><span class="pre">password</span></tt> for logins.</p>
<p>First start a console on the local machine, then ssh to the remote server:</p>
<div class="highlight-python"><pre>xdg-open ssh://`id -un`@HOSTNAME.DOMAIN.TLD</pre>
</div>
<p>Now explore the remote environment to identify Windows RDP servers. Recommended
commands are:</p>
<div class="highlight-python"><pre>smbclient -L NETBIOSNAME
smbtree</pre>
</div>
<p>These commands identify a windows session on host <tt class="docutils literal"><span class="pre">XPUSER</span></tt>. Now find the IP
for this machine using either of the commands:</p>
<div class="highlight-python"><pre>net lookup XPUSER
nmblookup XPUSER</pre>
</div>
<p>Suppose the remote Windows terminal server <strong>XPUSER</strong> uses IP <strong>192.168.2.243</strong>
in its local network. Display the PuTTY menu with <tt class="kbd docutils literal"><span class="pre">&lt;Ctrl-RightClick&gt;</span></tt>, and
choose <em class="menuselection">Change Settings...</em>. Then select Category:
<em class="menuselection">Connection &gt; SSH &gt; Tunnels</em> and enter:</p>
<div class="line-block">
<div class="line">Source port: <tt class="kbd docutils literal"><span class="pre">3389</span></tt></div>
<div class="line">Destination: <tt class="kbd docutils literal"><span class="pre">192.168.2.243:3389</span></tt></div>
<div class="line">Click &#8211; <tt class="kbd docutils literal"><span class="pre">Add</span></tt></div>
<div class="line">Click &#8211; <tt class="kbd docutils literal"><span class="pre">Apply</span></tt></div>
</div>
<p>Finally, open the KRDC Remote Desktop client on the KDE Desktop, and connect
using protocol <tt class="kbd docutils literal"><span class="pre">rdp</span></tt> to <tt class="kbd docutils literal"><span class="pre">localhost</span></tt>. A remote Windows RDP session
will display as if it were local, being redirected to you over SSH.</p>
</div>
</div>
<div class="section" id="using-samba4-shares">
<h2>Using SAMBA4 Shares<a class="headerlink" href="#using-samba4-shares" title="Permalink to this headline">¶</a></h2>
<div class="section" id="configuring-ubuntu-desktop">
<h3>Configuring Ubuntu desktop<a class="headerlink" href="#configuring-ubuntu-desktop" title="Permalink to this headline">¶</a></h3>
<p>The computer hostname must be valid for Windows; meaning it must start with a
letter, and only characters <tt class="kbd docutils literal"><span class="pre">A-Z</span></tt>, <tt class="kbd docutils literal"><span class="pre">0-9</span></tt>, or <tt class="kbd docutils literal"><span class="pre">._</span></tt> are allowed.
Edit the host/hostname configuration using the command:</p>
<div class="highlight-python"><pre>sudo nano /etc/hosts /etc/hostname</pre>
</div>
<p>Next install <strong class="program">samba4</strong> with the command:</p>
<div class="highlight-python"><pre>sudo apt-get install samba4</pre>
</div>
<p>Set the workgroup or domain for the computer with the command:</p>
<div class="highlight-python"><pre>(commands not found)</pre>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="04_packages.html" title="Managing Software Packages"
             >next</a></li>
        <li class="right" >
          <a href="02_secureshell.html" title="Remote Secure Shell Sessions"
             >previous</a> |</li>
        <li><a href="index.html">Configure KDE 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Gerald Lovel.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b3.
    </div>
  </body>
</html>