

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Mounting Network File Systems &mdash; Configure KDE 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Configure KDE 1.0 documentation" href="index.html" />
    <link rel="next" title="DOS programs with dosemu" href="05_dosemu.html" />
    <link rel="prev" title="Remote Secure Shell Sessions" href="02_secureshell.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="05_dosemu.html" title="DOS programs with dosemu"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="02_secureshell.html" title="Remote Secure Shell Sessions"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Configure KDE 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="mounting-network-file-systems">
<h1>Mounting Network File Systems<a class="headerlink" href="#mounting-network-file-systems" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This guide describes connecting to either local or remote server file systems
from Debian/Ubuntu/Mint desktops. Syntax will differ with other systems.</p>
</div>
<div class="section" id="using-sshfs-file-shares-in-linux">
<h2>Using sshfs File Shares in Linux<a class="headerlink" href="#using-sshfs-file-shares-in-linux" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Throughout these instructions, replace <strong>HOSTSERVER</strong>, <strong>DOMAIN</strong>, and
<strong>TLD</strong> with the name of the server to be accessed, the domain for the
server, and the top-level domain (.com, .net, etc.). For example,
<strong>HOSTSERVER.DOMAIN.TLD</strong> might be replaced with <em>workserver.aaltsys.com</em>
for the work server at AAltSys.</p>
</div>
<div class="section" id="part-1-configure-filesystems">
<h3>Part 1: Configure Filesystems<a class="headerlink" href="#part-1-configure-filesystems" title="Permalink to this headline">¶</a></h3>
<p>This section configures the desktop to use remote filesystems by installing and
loading the kernel module <strong>fuse</strong>, which is not included by default. Save the
bash script <a class="reference download internal" href="_downloads/fuse.sh"><tt class="xref download docutils literal"><span class="pre">fuse.sh</span></tt></a> to your home folder,
open a console session, and execute the script with the command:</p>
<div class="highlight-python"><pre>sudo bash fuse.sh</pre>
</div>
<p>Assign a mount point (a file directory pointer) for the remote server to use:</p>
<div class="highlight-python"><pre>sudo mkdir -p /mnt/HOSTSERVER/</pre>
</div>
</div>
<div class="section" id="part-2-setup-server-access">
<h3>Part 2. Setup Server Access<a class="headerlink" href="#part-2-setup-server-access" title="Permalink to this headline">¶</a></h3>
<p>This section is performed once for each remote server, to add information about
the server to the local desktop. Instructions are provided using Domain Names.
IP addresses would also work, but then the shares would not be accessible both
locally and remotely. When DNS is properly configured, access works whether the
connection is local, bridged, VPN, or public.</p>
<div class="sidebar">
<p class="first sidebar-title">/etc/auto.master</p>
<p>Each entry in <strong>auto.master</strong> defines a file access point which
binds to a remote server. For example, file requests to
<strong>/mnt/HOSTSERVER</strong> will automount <strong>HOSTSERVER</strong> shares.
Shares will be unmounted if idle for over 30 seconds.</p>
<p><strong>/etc/auto.HOSTSERVER</strong></p>
<p class="last">A list of share mappings is required for each remote server.
Here <strong>HOSTSERVER</strong> has two shares, <strong>PUBLIC</strong> and <strong>*</strong>. Entries
start with a name (e.g., <tt class="docutils literal"><span class="pre">public</span></tt>), followed by configuration
parameters: <tt class="docutils literal"><span class="pre">-fstype=fuse,rw,...</span></tt>,
and user ssh credentials: <tt class="docutils literal"><span class="pre">IdentityFile=$HOME/.ssh/id_rsa</span></tt>.
Last is the URI for accessing the share:
<tt class="docutils literal"><span class="pre">:sshfs\#$USER&#64;HOSTSERVER.DOMAIN.TLD\:/.../public</span></tt>.</p>
</div>
<p>Add a line describing your server to <strong>auto.master</strong> with the following console
command (remember, replace HOSTSERVER with your server name):</p>
<div class="highlight-python"><pre>sudo bash &lt; &lt;(echo 'echo "/mnt/HOSTSERVER /etc/auto.HOSTSERVER --timeout=30 --ghost" &gt;&gt; /etc/auto.master')</pre>
</div>
<p>Create and edit the server configuration file, <strong>auto.HOSTSERVER</strong>, to provide
server-specific information:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sudoedit</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">auto</span><span class="o">.</span><span class="n">HOSTSERVER</span>
</pre></div>
</div>
<p>and enter and save the share configuration information, such as:</p>
<div class="highlight-python"><pre>public -fstype=fuse,rw,nodev,nonempty,noatime,max_read=65536,allow_other,compression=yes,uid=$UID,gid=$GID,StrictHostKeyChecking=no,IdentityFile=$HOME/.ssh/id_rsa,umask=0007 :sshfs\#$USER@HOSTSERVER.DOMAIN.TLD\:/home/samba/shares/public/
* -fstype=fuse,rw,allow_other,nodev,nonempty,noatime,max_read=65536,compression=yes,uid=$UID,gid=$GID,StrictHostKeyChecking=no,IdentityFile=$HOME/.ssh/id_rsa,umask=0077 :sshfs\#$USER@HOSTSERVER.DOMAIN.TLD\:/home/&amp;</pre>
</div>
<p>Restart the autofs module to load the changed configuration:</p>
<div class="highlight-python"><pre>sudo /etc/init.d/autofs restart
sudo ssh HOSTSERVER.DOMAIN.TLD</pre>
</div>
<p>When prompted for the root password of the remote host, press <tt class="kbd docutils literal"><span class="pre">&lt;Ctrl-C&gt;</span></tt>
to exit the command.</p>
</div>
<div class="section" id="part-3-provide-your-ssh-key">
<h3>Part 3. Provide your ssh key<a class="headerlink" href="#part-3-provide-your-ssh-key" title="Permalink to this headline">¶</a></h3>
<p>This section must be performed for each local user who will access the remote
server. Type the following commands to (1) create an ssh private key provided
one does not exist, and (2) copy a user public key to the remote server for
authentication:</p>
<div class="highlight-python"><pre>if [ ! -f "$HOME/.ssh/id_rsa" ]; then ssh-keygen; fi
ssh-copy-id `id -un`@HOSTSERVER.DOMAIN.TLD</pre>
</div>
<p>Now verify that the remote folders will mount:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ls</span> <span class="o">-</span><span class="n">al</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">HOSTSERVER</span>
<span class="n">ls</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">HOSTSERVER</span><span class="o">/</span><span class="sb">`id -un`</span>
</pre></div>
</div>
<p>Create desktop links to folders in /mnt/HOSTSERVER for easy access. If the
workstation will access the server remotely, do not create bookmarks.</p>
</div>
<div class="section" id="when-this-does-not-work">
<h3>When this does not work<a class="headerlink" href="#when-this-does-not-work" title="Permalink to this headline">¶</a></h3>
<p>If the public folder or user home folder will not mount, try the following:</p>
<div class="highlight-python"><pre>ssh `id -un`@HOSTSERVER.DOMAIN.TLD
chmod og-w ~
chmod og-w ~/.ssh
chmod 600 ~/.ssh/authorized_keys</pre>
</div>
</div>
</div>
<div class="section" id="server-sshfs-configuration">
<h2>Server SSHFS Configuration<a class="headerlink" href="#server-sshfs-configuration" title="Permalink to this headline">¶</a></h2>
<p>Install authentication and sharing modules on the server as follows:</p>
<div class="highlight-python"><pre>sudo aptitude install openssh-server libpam-modules</pre>
</div>
<p>The default server umask=0022 will shade permissions for files and folders
created on the server. Private home folders with umask=0077 will work just
fine, but public folders needing umask=0007 will result in incorrect
permissions which block write access. To prevent this problem:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sudoedit</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">pam</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">sshd</span>
</pre></div>
</div>
<p>Now add the following three lines:</p>
<div class="highlight-python"><pre># Default umask mask for SSH/SFTP sessions
# Shell sessions: Override with /etc/profile or ~/.bashrc or ~/.profile
session optional        pam_umask.so umask=0000</pre>
</div>
<p>As noted above, actual ssh shell logins on the server will get the default
umask=022 on new files and directories. The following command will change this
for all shell logins:</p>
<div class="highlight-python"><pre>sudo sed -i s/umask 022/umask 0007/ /etc/profile</pre>
</div>
<p>A logged in user could change just their own default umask with the command:</p>
<div class="highlight-python"><pre>sudo sed -i s/#umask\ 022/umask\ 0007/ ~/.profile</pre>
</div>
<p>References:</p>
<p><a class="reference external" href="http://wiki.lapipaplena.org/index.php/How_to_mount_SFTP_accesses">How to mount SFTP accesses.</a></p>
</div>
<div class="section" id="accessing-servers-over-ssh">
<h2>Accessing Servers over SSH<a class="headerlink" href="#accessing-servers-over-ssh" title="Permalink to this headline">¶</a></h2>
<div class="section" id="redirecting-ssh-to-putty">
<h3>Redirecting SSH to PuTTY<a class="headerlink" href="#redirecting-ssh-to-putty" title="Permalink to this headline">¶</a></h3>
<p>PuTTY is an open-source cross-platform client for secure ssh connections with
remote hosts. It is available on Windows, Linux, and Mac, and it is the
preferred client on Windows. PuTTY adds power to interactive sessions. For
example, a user can add a port forwarding rule within a running terminal session.</p>
<p>For a KDE desktop system derived from Debian, the following console commands
will redirect SSH to PuTTY (courtesy of VonGrippen, AKA Michael Cochran):</p>
<div class="highlight-python"><pre>sudo bash &lt; &lt;(wget https://raw.github.com/gist/1030236/putty-kde.sh -O-)
sudo chmod +x /usr/bin/putty.rb</pre>
</div>
</div>
<div class="section" id="example-putty-session">
<h3>Example PuTTY Session:<a class="headerlink" href="#example-putty-session" title="Permalink to this headline">¶</a></h3>
<p>This program works magic which is best explained through an example, as follows.
An administrator wishes to connect to a remote Windows session running as a
virtual machine on a Linux server. The Linux server is accessed at the domain
name <tt class="docutils literal"><span class="pre">https://remoteserver.support.aaltsys.com</span></tt>. Both the Windows session and
the Linux server authenticate <tt class="docutils literal"><span class="pre">username</span></tt> and <tt class="docutils literal"><span class="pre">password</span></tt> for logins.</p>
<p>First start a console on the local machine, then ssh to the remote server:</p>
<div class="highlight-python"><pre>xdg-open ssh://`id -un`@HOSTNAME.DOMAIN.TLD</pre>
</div>
<p>Now explore the remote environment to identify Windows RDP servers. Recommended
commands are:</p>
<div class="highlight-python"><pre>smbclient -L NETBIOSNAME
smbtree</pre>
</div>
<p>These commands identify a windows session on host <tt class="docutils literal"><span class="pre">XPUSER</span></tt>. Now find the IP
for this machine using either of the commands:</p>
<div class="highlight-python"><pre>net lookup XPUSER
nmblookup XPUSER</pre>
</div>
<p>The remote Windows terminal server <strong>XPUSER</strong> uses IP <strong>192.168.2.243</strong> in its
local network. Display the PuTTY menu with &lt;Ctrl-RightClick&gt;, and choose
<em class="menuselection">Change Settings...</em>. Then select Category:
<em class="menuselection">Connection &gt; SSH &gt; Tunnels</em> and enter:</p>
<div class="highlight-python"><pre>Source port -- 3389
Destination -- 192.168.2.243:3389
Click -- Add
Click -- Apply</pre>
</div>
<p>Finally, open the KRDC Remote Desktop client on the KDE Desktop, and connect
to: <em class="guilabel">rdp</em> :kbd:<tt class="docutils literal"><span class="pre">localhost</span></tt>. A remote Windows RDP session will
display as if it were local, being redirected to you over SSH.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Mounting Network File Systems</a><ul>
<li><a class="reference internal" href="#using-sshfs-file-shares-in-linux">Using sshfs File Shares in Linux</a><ul>
<li><a class="reference internal" href="#part-1-configure-filesystems">Part 1: Configure Filesystems</a></li>
<li><a class="reference internal" href="#part-2-setup-server-access">Part 2. Setup Server Access</a></li>
<li><a class="reference internal" href="#part-3-provide-your-ssh-key">Part 3. Provide your ssh key</a></li>
<li><a class="reference internal" href="#when-this-does-not-work">When this does not work</a></li>
</ul>
</li>
<li><a class="reference internal" href="#server-sshfs-configuration">Server SSHFS Configuration</a></li>
<li><a class="reference internal" href="#accessing-servers-over-ssh">Accessing Servers over SSH</a><ul>
<li><a class="reference internal" href="#redirecting-ssh-to-putty">Redirecting SSH to PuTTY</a></li>
<li><a class="reference internal" href="#example-putty-session">Example PuTTY Session:</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="02_secureshell.html"
                        title="previous chapter">Remote Secure Shell Sessions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="05_dosemu.html"
                        title="next chapter">DOS programs with dosemu</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/03_servershares.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="05_dosemu.html" title="DOS programs with dosemu"
             >next</a> |</li>
        <li class="right" >
          <a href="02_secureshell.html" title="Remote Secure Shell Sessions"
             >previous</a> |</li>
        <li><a href="index.html">Configure KDE 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Gerald Lovel.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>